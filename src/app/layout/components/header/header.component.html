<mat-toolbar class="header-toolbar">

  <!-- Mobile Menu Button -->
  <button 
    mat-icon-button 
    class="menu-button"
    *ngIf="isHandset"
    (click)="onMenuToggle()"
    aria-label="Toggle navigation">
    <mat-icon>menu</mat-icon>
  </button>

  <!-- Logo/Brand -->
  <div class="brand" [class.mobile]="isHandset">
    <div class="logo">
      <mat-icon class="logo-icon">business</mat-icon>
      <span class="brand-text" [class.hidden]="isHandset">HRMS</span>
    </div>
  </div>

  <!-- Spacer -->
  <span class="spacer"></span>

  <!-- Header Actions -->
  <div class="header-actions">

    <!-- Search Section -->
    <div class="search-container">
      <!-- Toolbar search icon -->
      <button 
        mat-icon-button 
        class="search-trigger-button"
        *ngIf="!isHandset && !isSearchOpen"
        matTooltip="Search"
        aria-label="Search"
        (click)="toggleSearch()">
        <mat-icon>search</mat-icon>
      </button>

      <!-- Search input with enhanced styling -->
      <div class="header-search" *ngIf="isSearchOpen">
        <div class="search-input-wrapper">
          <mat-icon class="search-icon">search</mat-icon>
          <input
            #searchInput
            type="text"
            placeholder="Search pages, attendance, leave, performance..."
            class="search-input"
            [(ngModel)]="searchQuery"
            (ngModelChange)="onSearchChange($event)"
            (keydown.enter)="onSearch()"
            (blur)="onSearchBlur()"
          />
          <button 
            mat-icon-button 
            class="search-close-button"
            (click)="toggleSearch()"
            matTooltip="Close search"
            aria-label="Close search">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <!-- Enhanced dropdown suggestions -->
        <div class="search-suggestions" *ngIf="searchQuery.trim()">
          <div 
            class="suggestion-item" 
            *ngFor="let item of filteredItems" 
            (mousedown)="goToSection(item)"
            (click)="goToSection(item)">
            <mat-icon class="suggestion-icon">arrow_forward</mat-icon>
            <span class="suggestion-text">{{ item.name }}</span>
          </div>
          <div class="no-results" *ngIf="filteredItems.length === 0">
            <mat-icon class="no-results-icon">search_off</mat-icon>
            <span>No results found for "{{ searchQuery }}"</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Theme Toggle -->
    <button 
      mat-icon-button 
      class="action-button theme-toggle-button"
      (click)="onThemeToggle()"
      [matTooltip]="isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
      aria-label="Toggle theme">
      <mat-icon>{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
    </button>

    <!-- Notifications -->
    <div class="notification-container">
      <button 
        mat-icon-button 
        class="action-button notification-button"
        [class.has-notifications]="notificationCount > 0"
        (click)="onNotificationsClick()"
        matTooltip="Notifications"
        aria-label="Notifications">
        <mat-icon 
          [matBadge]="notificationCount" 
          [matBadgeHidden]="notificationCount === 0"
          matBadgeColor="warn" 
          matBadgeSize="small">
          notifications
        </mat-icon>
      </button>

      <!-- Dropdown -->
      <div class="notification-panel" *ngIf="isNotificationOpen">
        <app-notification-dialogue 
          [isOpen]="isNotificationOpen"
          (unreadCountChange)="notificationCount = $event">
        </app-notification-dialogue>
      </div>
    </div>

    <!-- User Menu -->
    <button 
      mat-icon-button 
      class="user-menu-button-pic" 
      [matMenuTriggerFor]="userMenu" 
      aria-label="User menu">
      <div class="user-avatar-pic">
        <p-avatar
          *ngIf="profilePreviewUrl; else initials"
          [image]="profilePreviewUrl"
          shape="circle"
          styleClass="user-avatar-large-content">
        </p-avatar>

        <ng-template #initials>
          <p-avatar
            [label]="getUserInitials()"
            shape="circle"
            styleClass="user-avatar-large-content">
          </p-avatar>
        </ng-template>
      </div>
      <div class="user-status-indicator"></div>
    </button>

  </div>

  <!-- User Menu -->
  <mat-menu #userMenu="matMenu" class="user-menu">
    <div class="user-menu-header">
      <div class="user-info">
        <div class="user-avatar-large">
          <p-avatar 
            *ngIf="profilePreviewUrl; else initialsLarge"
            [image]="profilePreviewUrl"
            size="large"
            shape="circle"
            styleClass="user-avatar-large-content">
          </p-avatar>

          <ng-template #initialsLarge>
            <p-avatar 
              [label]="getUserInitials()"
              size="large"
              shape="circle"
              styleClass="user-avatar-large-content">
            </p-avatar>
          </ng-template>
        </div>
        <div class="user-details">
          <div class="user-name">{{ getUserDisplayName() }}</div>
          <div class="user-email">{{ currentUser?.email }}</div>
          <div class="user-role">{{ currentUser?.roleName }}</div>
        </div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <button mat-menu-item (click)="onProfileClick()">
      <mat-icon>person</mat-icon>
      <span>My Profile</span>
    </button>

    <button mat-menu-item (click)="onSettingsClick()">
      <mat-icon>settings</mat-icon>
      <span>Settings</span>
    </button>

    <mat-divider></mat-divider>

    <button mat-menu-item class="logout-item" (click)="onLogout()">
      <mat-icon>logout</mat-icon>
      <span>Logout</span>
    </button>
  </mat-menu>

</mat-toolbar>
