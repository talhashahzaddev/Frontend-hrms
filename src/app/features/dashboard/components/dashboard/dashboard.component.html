<!-- Dashboard Container -->
<div class="dashboard-container">
  
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <p>Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading" class="dashboard-content">
    
    <!-- Header Section -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">
          <mat-icon>dashboard</mat-icon>
          Dashboard
        </h1>
        <p class="page-subtitle">Welcome back! Here's what's happening in your organization.</p>
      </div>
      
      <div class="header-actions">
        <!-- Period Selector -->
        <div class="period-selector">
          <button mat-stroked-button [matMenuTriggerFor]="periodMenu" class="period-button">
            <mat-icon>date_range</mat-icon>
            {{ getSelectedPeriodLabel() }}
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
          <mat-menu #periodMenu="matMenu">
            <button *ngFor="let period of periodOptions" 
                    mat-menu-item 
                    (click)="onPeriodChange(period.value)"
                    [class.active]="isSelectedPeriod(period.value)">
              {{ period.label }}
            </button>
          </mat-menu>
        </div>

        <!-- Refresh Button -->
        <button mat-icon-button 
                (click)="refreshDashboard()" 
                matTooltip="Refresh Dashboard"
                class="refresh-button">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    <!-- Quick Stats Cards -->
    <div class="stats-grid">
      <mat-card *ngFor="let card of dashboardCards; trackBy: trackByFn" 
                class="stat-card" 
                [ngClass]="'stat-card-' + card.color"
                [routerLink]="card.route">
        
        <div class="stat-content">
          <div class="stat-icon">
            <mat-icon>{{ card.icon }}</mat-icon>
          </div>
          
          <div class="stat-details">
            <h3 class="stat-title">{{ card.title }}</h3>
            <div class="stat-value">{{ card.value }}</div>
            <div *ngIf="card.change" class="stat-change" [ngClass]="'change-' + card.changeType">
              <mat-icon *ngIf="isChangeType(card.changeType, 'increase')">trending_up</mat-icon>
              <mat-icon *ngIf="isChangeType(card.changeType, 'decrease')">trending_down</mat-icon>
              <mat-icon *ngIf="isChangeType(card.changeType, 'neutral')">remove</mat-icon>
              {{ card.change }}
            </div>
          </div>
        </div>
      </mat-card>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="charts-row">
        
        <!-- Attendance Chart -->
        <mat-card class="chart-card" *ngIf="attendanceChart">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>access_time</mat-icon>
              Attendance Trends
            </mat-card-title>
            <div class="card-actions">
              <button mat-icon-button [matMenuTriggerFor]="chartMenu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #chartMenu="matMenu">
                <button mat-menu-item (click)="exportChart('attendance')">
                  <mat-icon>download</mat-icon>Export
                </button>
                <button mat-menu-item (click)="refreshChart('attendance')">
                  <mat-icon>refresh</mat-icon>Refresh
                </button>
              </mat-menu>
            </div>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-container">
              <!-- Chart implementation would go here -->
              <p>Attendance chart placeholder</p>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Department Distribution -->
        <mat-card class="chart-card" *ngIf="hasDepartmentStats()">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>business</mat-icon>
              Department Distribution
            </mat-card-title>
            <div class="card-actions">
              <button mat-stroked-button routerLink="/employees" class="view-all-button">
                View All
              </button>
            </div>
          </mat-card-header>
          <mat-card-content>
            <div class="department-stats">
              <div *ngFor="let dept of departmentStats; trackBy: trackByDept" 
                   class="department-item">
                
                <div class="department-info">
                  <div class="department-name">{{ dept.name }}</div>
                  <div class="department-count">{{ dept.count }} employees</div>
                </div>
                
                <div class="department-progress">
                  <mat-progress-bar [value]="getDepartmentPercentage(dept.count)" 
                                   mode="determinate">
                  </mat-progress-bar>
                  <span class="percentage">{{ getDepartmentPercentage(dept.count) }}%</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Activities and Events Section -->
    <div class="activities-section">
      <div class="activities-row">
        
        <!-- Recent Activities -->
        <mat-card class="activities-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>notifications</mat-icon>
              Recent Activities
            </mat-card-title>
            <div class="card-actions">
              <button mat-stroked-button routerLink="/activities" class="view-all-button">
                View All
              </button>
            </div>
          </mat-card-header>
          <mat-card-content>
            <div *ngIf="!hasActivities()" class="empty-state">
              <mat-icon>inbox</mat-icon>
              <p>No recent activities</p>
            </div>
            
            <div *ngIf="hasActivities()" class="activities-list">
              <div *ngFor="let activity of recentActivities; trackBy: trackByActivity" 
                   class="activity-item">
                
                <div class="activity-icon">
                  <mat-icon [ngClass]="getActivityIconClass(activity.type)">{{ activity.icon }}</mat-icon>
                </div>
                
                <div class="activity-content">
                  <div class="activity-title">{{ activity.title }}</div>
                  <div class="activity-description">{{ activity.description }}</div>
                  <div class="activity-time">{{ formatActivityTime(activity.timestamp) }}</div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Upcoming Events -->
        <mat-card class="events-card" *ngIf="hasUpcomingEvents()">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>event</mat-icon>
              Upcoming Events
            </mat-card-title>
            <div class="card-actions">
              <button mat-stroked-button routerLink="/events" class="view-all-button">
                View All
              </button>
            </div>
          </mat-card-header>
          <mat-card-content>
            <div class="events-list">
              <div *ngFor="let event of upcomingEvents; trackBy: trackByEvent" 
                   class="event-item">
                
                <div class="event-date">
                  <div class="event-day">{{ getEventDay(event.date) }}</div>
                  <div class="event-month">{{ getEventMonth(event.date) }}</div>
                </div>
                
                <div class="event-content">
                  <div class="event-title">{{ event.title }}</div>
                  <div class="event-description">{{ event.description }}</div>
                  <div class="event-time">{{ formatEventTime(event.date, event.time) }}</div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Performance Summary -->
        <mat-card class="performance-card" *ngIf="performanceStats">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>trending_up</mat-icon>
              Performance Summary
            </mat-card-title>
            <div class="card-actions">
              <button mat-stroked-button routerLink="/performance" class="view-all-button">
                View Details
              </button>
            </div>
          </mat-card-header>
          <mat-card-content>
            <div class="performance-overview">
              <div class="performance-metric">
                <div class="metric-value">{{ performanceStats.averageRating }}</div>
                <div class="metric-label">Average Rating</div>
                <div class="metric-stars">
                  <mat-icon *ngFor="let star of getStarArray(performanceStats.averageRating); let i = index"
                           [ngClass]="getStarClass(i, performanceStats.averageRating)">star</mat-icon>
                </div>
              </div>
              
              <div class="performance-breakdown">
                <div class="breakdown-item">
                  <span class="breakdown-label">Completed Reviews</span>
                  <span class="breakdown-value">{{ performanceStats.completedReviews }}</span>
                </div>
                <div class="breakdown-item">
                  <span class="breakdown-label">Pending Reviews</span>
                  <span class="breakdown-value">{{ performanceStats.pendingReviews }}</span>
                </div>
                <div class="breakdown-item">
                  <span class="breakdown-label">Top Performers</span>
                  <span class="breakdown-value">{{ performanceStats.topPerformers }}</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>