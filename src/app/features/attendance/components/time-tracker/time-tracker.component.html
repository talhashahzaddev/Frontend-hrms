<!-- Time Tracker Container -->
<div class="time-tracker-container">
  
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>timer</mat-icon>
        Time Tracker
      </h1>
      <p class="page-subtitle">Track your working hours and manage your time</p>
    </div>
    
    <div class="current-time">
      <div class="time-display">{{ currentTime | date:'HH:mm:ss' }}</div>
      <div class="date-display">{{ currentTime | date:'dd-MM-yyyy' }}</div>
    </div>
  </div>

  <!-- Clock In/Out Section -->
  <mat-card class="clock-card">
    <mat-card-content>
      <div class="clock-section">
        <div class="clock-status">
          <div class="status-indicator" [class.active]="currentSession?.isActive">
            <mat-icon>{{ currentSession?.isActive ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
          </div>
          <div class="status-text">
            <h3>{{ currentSession?.isActive ? 'Currently Working' : 'Not Clocked In' }}</h3>
            <p *ngIf="currentSession?.isActive && currentSession?.checkInTime">
              Started at: {{ currentSession?.checkInTime | date:'HH:mm' }}
            </p>
            <p *ngIf="currentSession?.isActive">
              Duration: {{ formatElapsedTime(currentSession?.elapsedHours || 0) }}
            </p>
            <p *ngIf="!currentSession?.isActive">Ready to start your workday?</p>
          </div>
        </div>

        <div class="clock-actions">
          <button mat-flat-button 
                  (click)="clockIn()" 
                  [disabled]="currentSession?.isActive || isClockActionLoading"
                  class="clock-in-button">
            <mat-spinner *ngIf="isClockActionLoading && !currentSession?.isActive" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isClockActionLoading">login</mat-icon>
            Clock In
          </button>
          
          <button mat-flat-button 
                  (click)="clockOut()" 
                  [disabled]="!currentSession?.isActive || isClockActionLoading"
                  class="clock-out-button">
            <mat-spinner *ngIf="isClockActionLoading && currentSession?.isActive" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isClockActionLoading">logout</mat-icon>
            Clock Out
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Today's Summary -->
  <mat-card class="summary-card" *ngIf="todayAttendance">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>today</mat-icon>
        Today's Summary
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Check In</div>
          <div class="summary-value">
            {{ todayAttendance.checkInTime ? (todayAttendance.checkInTime | date:'HH:mm') : '--:--' }}
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Check Out</div>
          <div class="summary-value">
            {{ todayAttendance.checkOutTime ? (todayAttendance.checkOutTime | date:'HH:mm') : '--:--' }}
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Total Hours</div>
          <div class="summary-value">{{ formatHours(todayAttendance.totalHours) }}</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Status</div>
          <div class="summary-value">
            <mat-chip [class]="'status-' + todayAttendance.status">
              {{ todayAttendance.status | titlecase }}
            </mat-chip>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Quick Actions -->
  <div class="quick-actions-grid">
    <mat-card class="action-card" routerLink="/attendance/dashboard">
      <mat-card-content>
        <div class="action-content">
          <mat-icon>calendar_today</mat-icon>
          <h3>My Attendance</h3>
          <p>View your attendance history and calendar</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="action-card" routerLink="/attendance/reports" *ngIf="!isEmployee">
      <mat-card-content>
        <div class="action-content">
          <mat-icon>assessment</mat-icon>
          <h3>Reports</h3>
          <p>Generate and export attendance reports</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="action-card" routerLink="/attendance/team-attendance" *ngIf="canViewTeamAttendance">
      <mat-card-content>
        <div class="action-content">
          <mat-icon>groups</mat-icon>
          <h3>Team Attendance</h3>
          <p>Monitor your team's attendance</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>


 <!-- Today's Sessions -->
<mat-card class="recent-activity-card today-sessions-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>today</mat-icon>
      Today's Sessions
    </mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <!-- Loading State -->
    <div *ngIf="isLoadingSessions" class="loading-container">
      <mat-spinner diameter="30"></mat-spinner>
      <p>Loading today's sessions...</p>
    </div>

    <!-- Session List -->
    <div *ngIf="!isLoadingSessions && todaySessions.length > 0" class="activity-list">
      <div class="activity-item" *ngFor="let session of todaySessions">
        <div class="activity-date">
          <div class="day">{{ session.checkInTime | date:'d' }}</div>
          <div class="month">{{ session.checkInTime | date:'MMM' }}</div>
        </div>
        <div class="activity-details">
          <div class="activity-time">
            <span class="check-in">
              <mat-icon>login</mat-icon>
              {{ session.checkInTime | date:'HH:mm' }}
            </span>
            <span class="separator">â†’</span>
            <span class="check-out">
              <mat-icon>logout</mat-icon>
              {{ session.checkOutTime ? (session.checkOutTime | date:'HH:mm') : '--:--' }}
            </span>
          </div>
          <div class="activity-summary">
            <span class="hours">{{ formatSessionDuration(session.checkInTime, session.checkOutTime) }}</span>
            <!-- <mat-chip [class]="'status-' + session.status" class="status-chip">
              {{ session.status | titlecase }}
            </mat-chip> -->
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoadingSessions && todaySessions.length === 0" class="empty-state">
      <mat-icon>schedule</mat-icon>
      <p>No sessions recorded for today</p>
    </div>
  </mat-card-content>
</mat-card>


<!-- Filters Section (Date Filter) -->
<mat-card class="filters-card">
  <div class="filters-header">
    <h3>Filter Attendance</h3>
 
  </div>

  <div class="filters-content">
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Start Date</mat-label>
      <input matInput [matDatepicker]="startPicker" [(ngModel)]="filterStartDate" placeholder="Choose start date">
      <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
      <mat-datepicker #startPicker></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>End Date</mat-label>
      <input matInput [matDatepicker]="endPicker" [(ngModel)]="filterEndDate" placeholder="Choose end date">
      <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
      <mat-datepicker #endPicker></mat-datepicker>
    </mat-form-field>

    <div class="filter-actions-container">
      <button mat-flat-button color="primary" (click)="applyDateFilter()" class="add-button">
        <mat-icon>filter_list</mat-icon>
        Apply Filter
      </button>
    </div>
  </div>
</mat-card>

<!-- Attendance Table -->
<mat-card class="table-card">
  <div class="table-header">
    <h3>Recent Attendance ({{ recentAttendance.length }})</h3>
  </div>

  <div class="table-container">
    <mat-spinner *ngIf="isLoading" diameter="50"></mat-spinner>

    <table mat-table [dataSource]="recentAttendance" *ngIf="!isLoading && recentAttendance.length > 0" class="attendance-table">

      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let record"> {{ record.workDate | date:'dd-MM-yyyy' }} </td>
      </ng-container>

      <!-- Check-in Column -->
      <ng-container matColumnDef="checkIn">
        <th mat-header-cell *matHeaderCellDef> Check-in </th>
        <td mat-cell *matCellDef="let record">
          {{ record.checkInTime ? (record.checkInTime | date:'HH:mm') : '--:--' }}
        </td>
      </ng-container>

      <!-- Check-out Column -->
      <ng-container matColumnDef="checkOut">
        <th mat-header-cell *matHeaderCellDef> Check-out </th>
        <td mat-cell *matCellDef="let record">
          {{ record.checkOutTime ? (record.checkOutTime | date:'HH:mm') : '--:--' }}
        </td>
      </ng-container>

      <!-- Hours Column -->
      <ng-container matColumnDef="hours">
        <th mat-header-cell *matHeaderCellDef> Hours </th>
        <td mat-cell *matCellDef="let record"> {{ formatHours(record.totalHours) }} </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Status </th>
        <td mat-cell *matCellDef="let record">
          <mat-chip [class]="'status-' + record.status">{{ record.status | titlecase }}</mat-chip>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['date','checkIn','checkOut','hours','status']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['date','checkIn','checkOut','hours','status'];"></tr>
    </table>

    <!-- Empty State -->
    <div *ngIf="!isLoading && recentAttendance.length === 0" class="empty-state">
      <mat-icon>schedule</mat-icon>
      <h3>No Attendance Records Found</h3>
      <p>No attendance records match the current filter.</p>
    </div>
  </div>
</mat-card>



</div>
